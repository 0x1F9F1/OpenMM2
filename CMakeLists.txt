cmake_minimum_required(VERSION 3.10 FATAL_ERROR)

project(OpenMM2 CXX)

set(CMAKE_VS_INCLUDE_INSTALL_TO_DEFAULT_BUILD 1)

add_subdirectory(vendor)

file(GLOB ${PROJECT_NAME}_SRCS
    OpenMM2/*.cpp
    OpenMM2/*.h)

add_library(${PROJECT_NAME} SHARED
    ${${PROJECT_NAME}_SRCS})

target_include_directories(${PROJECT_NAME} SYSTEM PRIVATE
    include
    vendor)

find_library(DPLAY_LIBRARY dplayx
    HINTS vendor/dplay/lib)

target_link_libraries(${PROJECT_NAME} ${DPLAY_LIBRARY} dxguid mem)

file(STRINGS "GameDirectory.txt" GAME_DIRECTORY)

message(${GAME_DIRECTORY})

set_target_properties(${PROJECT_NAME} PROPERTIES
    CXX_STANDARD 14
    CXX_STANDARD_REQUIRED ON
    ARCHIVE_OUTPUT_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}/bin
    LIBRARY_OUTPUT_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}/bin
    RUNTIME_OUTPUT_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}/bin
    VS_DEBUGGER_COMMAND "${GAME_DIRECTORY}/Midtown2.exe"
    VS_DEBUGGER_WORKING_DIRECTORY "${GAME_DIRECTORY}"
    VS_INCLUDE_INSTALL_TO_DEFAULT_BUILD 1
    BUILD_TYPE "RelWithDebInfo"
    OUTPUT_NAME "dinput"
)

install(TARGETS ${PROJECT_NAME} RUNTIME DESTINATION ${GAME_DIRECTORY})
install(FILES $<TARGET_PDB_FILE:${PROJECT_NAME}> DESTINATION ${GAME_DIRECTORY} OPTIONAL)
